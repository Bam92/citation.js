<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Source: Cite/get.js - Docs - Citation.js</title>
    
    <meta name="theme-color" content="#FFC107">
    <link rel="shortcut icon" type="image/png" href="../favicon.png"/>
    <link rel="icon" type="image/png" href="../favicon.png"/>
    
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
    <link type="text/css" rel="stylesheet" href="../static/css/api.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: Cite/get.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import striptags from 'striptags'

import { getPrefixedEntry } from '../util/attr.js'

import getBibTeXJSON from '../get/bibtex/json'
import getBibTeX from '../get/bibtex/text'
import getBibTxt from '../get/bibtxt'
import getJSON from '../get/json'

import parseCsl from '../parse/csl'

import fetchCSLEngine from '../CSL/engines'
import fetchCSLStyle from '../CSL/styles'
import fetchCSLLocale from '../CSL/locales'
import fetchCSLItemCallback from '../CSL/items'

/**
 * Get a list of the data entry IDs, in the order of that list
 *
 * @method getIds
 * @memberof Cite
 * @this Cite
 *
 * @return {String[]} List of IDs
 */
const getIds = function () {
  return this.data.map(entry => entry.id)
}

/**
 * Get formatted data from your object. For more info, see [Output](../#output).
 *
 * @method get
 * @memberof Cite
 * @this Cite
 *
 * @param {Object} [options={}] - The options for the output. See [input options](../#citation.cite.in.options)
 *
 * @return {String|Object[]} The formatted data
 */
const get = function (options = {}) {
  const {format, type, style, lang} = Object.assign({}, this.defaultOptions, this._options, options)
  const [, styleType, styleFormat] = style.match(/^([^-]+)(?:-(.+))?$/)

  const data = parseCsl(this.data)
  let result

  switch ([type, styleType].join()) {
    case 'html,citation':
      const useLang = fetchCSLLocale(lang) ? lang : 'en-US'
      const useTemplate = fetchCSLStyle(styleFormat)
      const cbItem = fetchCSLItemCallback(data)

      const citeproc = fetchCSLEngine(styleFormat, useLang, useTemplate, cbItem, fetchCSLLocale)
      const sortedIds = citeproc.updateItems(this.getIds())

      let [{bibstart: bibStart, bibend: bibEnd}, bibBody] = citeproc.makeBibliography()
      bibBody = bibBody.map((element, index) => getPrefixedEntry(element, sortedIds[index]))

      result = `${bibStart}${bibBody.join('&lt;br />')}${bibEnd}`
      break

    case 'html,csl':
      result = getJSON(data)
      break

    case 'html,bibtex':
      result = getBibTeX(data, true)
      break

    case 'string,bibtex':
      result = getBibTeX(data, false)
      break

    case 'html,bibtxt':
      result = getBibTxt(data, true)
      break

    case 'string,bibtxt':
      result = getBibTxt(data, false)
      break

    case 'string,citation':
      result = striptags(this.get(Object.assign({}, options, {type: 'html'})))
      break

    case 'string,csl':
      result = JSON.stringify(data)
      break

    case 'json,csl':
      result = JSON.stringify(data)
      break

    case 'json,bibtex':
    case 'json,bibtxt':
      result = JSON.stringify(data.map(getBibTeXJSON))
      break

    case 'json,citation':
      console.error('[get]', `Combination type/style of json/citation-* is not valid: ${type}/${style}`)//
      break

    default:
      console.error('[get]', 'Invalid options')
      break
  }

  if (format === 'real') {
    if (type === 'json') {
      result = JSON.parse(result)
    } else if (type === 'html' &amp;&amp; typeof document !== 'undefined' &amp;&amp; document.createElement) {
      const tmp = document.createElement('div')
      tmp.innerHTML = result
      result = tmp.firstChild
    }
  }

  return result
}

export { getIds, get }
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Cite.html">Cite</a></li><li><a href="CSL.html">CSL</a></li><li><a href="TokenStack.html">TokenStack</a></li></ul><h3>Global</h3><ul><li><a href="global.html#addLocale">addLocale</a></li><li><a href="global.html#addTemplate">addTemplate</a></li><li><a href="global.html#async">async</a></li><li><a href="global.html#deepCopy">deepCopy</a></li><li><a href="global.html#fetchBibTeXType">fetchBibTeXType</a></li><li><a href="global.html#fetchCSLEngine">fetchCSLEngine</a></li><li><a href="global.html#fetchCSLItemCallback">fetchCSLItemCallback</a></li><li><a href="global.html#fetchCSLLocale">fetchCSLLocale</a></li><li><a href="global.html#fetchCSLStyle">fetchCSLStyle</a></li><li><a href="global.html#fetchDoiType">fetchDoiType</a></li><li><a href="global.html#fetchFile">fetchFile</a></li><li><a href="global.html#fetchFileAsync">fetchFileAsync</a></li><li><a href="global.html#fetchId">fetchId</a></li><li><a href="global.html#fetchWikidataType">fetchWikidataType</a></li><li><a href="global.html#getAttributedEntry">getAttributedEntry</a></li><li><a href="global.html#getBibTeX">getBibTeX</a></li><li><a href="global.html#getBibTeXJSON">getBibTeXJSON</a></li><li><a href="global.html#getBibTeXLabel">getBibTeXLabel</a></li><li><a href="global.html#getBibTxt">getBibTxt</a></li><li><a href="global.html#getDate">getDate</a></li><li><a href="global.html#getJSON">getJSON</a></li><li><a href="global.html#getLabel">getLabel</a></li><li><a href="global.html#getLocale">getLocale</a></li><li><a href="global.html#getName">getName</a></li><li><a href="global.html#getPrefixedEntry">getPrefixedEntry</a></li><li><a href="global.html#getTemplate">getTemplate</a></li><li><a href="global.html#hasLocale">hasLocale</a></li><li><a href="global.html#hasTemplate">hasTemplate</a></li><li><a href="global.html#htmlDict">htmlDict</a></li><li><a href="global.html#parseBibTeX">parseBibTeX</a></li><li><a href="global.html#parseBibTeXJSON">parseBibTeXJSON</a></li><li><a href="global.html#parseBibTeXProp">parseBibTeXProp</a></li><li><a href="global.html#parseBibTeXType">parseBibTeXType</a></li><li><a href="global.html#parseBibTxt">parseBibTxt</a></li><li><a href="global.html#parseBibTxtEntry">parseBibTxtEntry</a></li><li><a href="global.html#parseContentMine">parseContentMine</a></li><li><a href="global.html#parseCsl">parseCsl</a></li><li><a href="global.html#parseDate">parseDate</a></li><li><a href="global.html#parseDoi">parseDoi</a></li><li><a href="global.html#parseDoiApi">parseDoiApi</a></li><li><a href="global.html#parseDoiApiAsync">parseDoiApiAsync</a></li><li><a href="global.html#parseDoiJson">parseDoiJson</a></li><li><a href="global.html#parseInput">parseInput</a></li><li><a href="global.html#parseInputAsync">parseInputAsync</a></li><li><a href="global.html#parseInputChainLink">parseInputChainLink</a></li><li><a href="global.html#parseInputChainLinkAsync">parseInputChainLinkAsync</a></li><li><a href="global.html#parseInputData">parseInputData</a></li><li><a href="global.html#parseInputDataAsync">parseInputDataAsync</a></li><li><a href="global.html#parseInputType">parseInputType</a></li><li><a href="global.html#parseJSON">parseJSON</a></li><li><a href="global.html#parseName">parseName</a></li><li><a href="global.html#parseWikidata">parseWikidata</a></li><li><a href="global.html#parseWikidataJSON">parseWikidataJSON</a></li><li><a href="global.html#parseWikidataJSONAsync">parseWikidataJSONAsync</a></li><li><a href="global.html#parseWikidataProp">parseWikidataProp</a></li><li><a href="global.html#parseWikidataPropAsync">parseWikidataPropAsync</a></li><li><a href="global.html#textDict">textDict</a></li><li><a href="global.html#varRegex">varRegex</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.3</a>
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>