<!DOCTYPE html>
<html>
  <head>
    <title>API Demo - Citation.js</title>
    <meta charset="UTF-8">
    <link rel="shortcut icon" type="image/png" href="../favicon.png"/>
    <link rel="icon" type="image/png" href="../favicon.png"/>
    <style>
      body {margin:0 auto;width:60%;max-width:750px;font-family:'Helvetica Neue', Helvetica, Arial, sans-serif;}
      div, p {width:100%;}
      h1,h2,h3 {width:100%;text-align:center;}
      div.in                  {height:300px;border:1px solid #888;overflow-y:auto;margin-top:20px;background:white;font-family:monospace;white-space:pre;}
      div.in[data-type="url"] {height:2em;line-height:2em;}
      div.out {overflow-x:auto;white-space:pre-wrap;}
      fieldset {border:0 none transparent;padding-left:0;display:inline-block;}
      
      /* Highlight */
      .javascript,.bibtex,.url {white-space:pre;font-family:monospace;}
      pre {background-color:#f0f0f0;overflow-x:auto;}
        /* JavaScript/JSON */
          .javascript span.default {font-weight:normal;color:#000000;}
          .javascript span.important {text-decoration:underline}
          .javascript span.key {font-weight:normal;color:#0057ae;}
          .javascript span.function {font-weight:normal;color:#644a9b;}
          .javascript span.native {font-weight:bold;color:#000;}
          .javascript span.object {font-weight:normal;color:#006e28;}
          .javascript span.comment,
          .javascript span.comment span {font-weight:normal;color:#888;}
          .javascript span.string ,
          .javascript span.string span {font-weight:normal;color:#bf0303;}
          .javascript span.digit {font-weight:normal;color:#b08000;}
          .javascript span.normal {font-weight:normal;color:#000;}
          .javascript span.delimiter:after,
          .javascript span.delimiter:before {content:' '}
        /* BibTeX */
          .bibtex span.default {font-weight:normal;color:#000000;}
          .bibtex span.entrytype {font-weight:bold;color:#000000;}
          .bibtex span.label {font-weight:bold;color:#006e28;}
          .bibtex span.property {font-weight:normal;color:#0057ae;}
          .bibtex span.string {font-weight:normal;color:#bf0303;}
          .bibtex span.digit {font-weight:normal;color:#b08000;}
        /* URL */
          .url span.protocol {color:#888;}
          .url span.domain {color:#000}
          .url span.path {color:#888;}
          .url span.parameters {color:#888;}
    </style>
  </head>
  <body>
    <h1>Citation.js - demo</h1>
    <h2>Input:</h2>
    <h4><a href="http://bibtxt.github.io">Bib.TXT</a>:</h4>
    <div id="in" class="in" contenteditable="true" spellcheck="false"><!--
-->[Fau86]
  author:    J.W. Goethe
  title:     Faust. Der Trag√∂die Erster Teil
  publisher: Reclam
  year:      1986
  address:   Stuttgart<!--
      --></div>
    <h2>Output:</h2>
    <fieldset>
      <legend>HTML or plain text:</legend>
      <select class="type">
        <option value="html">HTML</option>
        <option value="json">JSON</option>
        <option value="string">Plain text</option>
      </select>
    </fieldset>
    <fieldset>
      <legend>Style:</legend>
      <select class="style">
        <option value="citation-apa">APA</option>
        <option value="citation-vancouver">Vancouver</option>
        <option value="citation-harvard1">Harvard</option>
        <option value="csl">CSL-JSON</option>
        <option value="bibtex">BibTeX</option>
        <option value="bibtxt">Bib.TXT</option>
      </select>
    </fieldset>
    <fieldset>
      <legend>Language:</legend>
      <select class="lang">
        <option value="en-US">English</option>
        <option value="fr-FR">French</option>
        <option value="es-ES">Spanish</option>
        <option value="de-DE">German</option>
        <option value="nl-NL">Dutch</option>
      </select>
    </fieldset>
    <div id="out"></div>
    <h2>Live code:</h2>
    <pre><code data-type="js" class="javascript"></code></pre>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script type="text/javascript" src="../src/citation.js"></script>
    <script type="text/javascript">
      /* Code highlighting. Feel free to use, but note it isn't that solid */
      jQuery.fn.highlight = function() {
        $(this).each(function(){
          var elm = $(this);
          switch(elm.data('type')){
            case 'json':case 'js':
              elm.html(elm.text()
                .replace(/([^\"]*)([\"][^\"]*[\"])([^\"]*)/gi,'$1<span class="string">$2</span>$3')
                .replace(/([^\']*)([\'][^\']*[\'])([^\']*)/gi,'$1<span class="string">$2</span>$3')
                .replace(/(function|this|document|for|if|else|var|true|false|throw|return|while|break|typeof|catch|new|undefined|null|class|yield|let|const|switch|break|case|continue|try|delete|in|of)([\s()]+)/g,
                  '<span class="native">$1</span>$2')
                .replace(/(\w+)(?=\.)/gi, '<span class="object">$1</span>')
                .replace(/(cite)([(<])/gi, '<span class="important">$1</span>$2')
                .replace(/(cite)([^\(<])/gi, '<span class="important">$1</span>$2')
                .replace(/(\w+)(\s*\:)/gi,'<span class="key">$1</span>$2')
                .replace(/([\s\.{};(])([\w$]+)(?=\s*\()/gi,'$1<span class="function">$2</span>')
                .replace(/^(.*)(\/\/.*)$/gim,'$1<span class="comment">$2</span>')
                .replace(/(\/\*[\s\S]*?\*\/)/gi,'<span class="comment">$1</span>')
                .replace(/(-?(?:\d+\.\d+|\d+\.|\.\d+|\d+)(?:e\d+)?)/gi,'<span class="digit">$1</span>')
              );
              break;
            case 'bib':
              elm.html(elm.text()
                .replace(/(=\s*)(?:("{)(.*?)(}")|(")(.*?)(")|({{)(.*?)(}})|({)(.*?)(})|(.*?))(?=\s*[,}])/g,
                        function (m,p1,p2,p3,p4,p5,p6,p7,p8,p9,p10,p11,p12,p13,p14) {
                          p1=p1||'',p2=p2||'',p3=p3||'',p4=p4||'',p5=p5||'',p6=p6||'',p7=p7||'',p8=p8||'',
                          p9=p9||'',p10=p10||'',p11=p11||'',p12=p12||'',p13=p13||'',p14=p14||'';
                          var rgx = /^\d+$/, string = (
                            p3 .match( rgx ) ||
                            p6 .match( rgx ) ||
                            p9 .match( rgx ) ||
                            p12.match( rgx ) ||
                            p14.match( rgx )
                          ) ?
                            'digit'
                          :
                            'string';
                          
                          return `${p1+p2+p5+p8+p11}<span class="${string}">${p3+p6+p9+p12+p14}</span>${p4+p7+p10+p13}`//
                        })
                .replace(/(\@)([^\@\{]+)(\{)(\w+)(\,)/gi,'$1<span class="entrytype">$2</span>$3<span class="label">$4</span><span class="default">$5</span>')
                .replace(/(\w+)\s*(\=)(\s|[^\'\"\w]+)/gi,'<span class="property">$1</span> $2 ')
              );
              break;
            case 'url':
              elm.html(elm.text()
                .replace(/(https?:\/\/)?((([a-z\d]([a-z\d-]*[a-z\d])*)\.)+[a-z]{2,}|((\d{1,3}\.){3}\d{1,3}))(\:\d+)?((\/[-a-z\d%_.~+:]*)*)(\?[;&a-z\d%_.~+=-]*)?(\#[-a-z\d_]*)?/gi,
                  '<span class="protocol">$1</span>'+
                  '<span class="domain">$2$8</span>'+
                  '<span class="path">$9$12</span>'+
                  '<span class="parameters">$11</span>'
                )
              )
              break;
            default:return;break;
          }
        });
      }
    </script>
    <script class="code" type="text/javascript">
// Set variables
var cite = new require('citation-js')(),
    opt = {format: 'string'}

$(function () {
  function update () {
    // Get user options
    opt.type = $('select.type').val()
    opt.style = $('select.style').val()
    opt.lang = $('select.lang').val()

    // Update output
    cite.set($('#in'))
    $('#out').html(cite.get(opt))
  }
  
  $('.in').on('blur', update)
  $('select').on('change', update)
  update()
})
    </script>
    <script type="text/javascript">
      $(window).on('load',function(){
        // Insert live code, directly from the script element (!)
        $('pre code.javascript').html($('.code').html());       
        
        // Highlight all code
        $('.javascript,.in').highlight();
        
        // Remove and re-add highlighting on focus and blur
        $('.in').focus(function(){$(this).find('span').each(function(){$(this).after(this.textContent);$(this).remove();});});
        $('.in').blur(function(){$(this).highlight()});
      });
    </script>
  </body>
</html>