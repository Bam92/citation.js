<!DOCTYPE html>
<html>
  <head>
    <title>API Demo - Citation.js</title>
    <meta charset="UTF-8">
    <link rel="shortcut icon" type="image/png" href="../favicon.png"/>
    <link rel="icon" type="image/png" href="../favicon.png"/>
    <style>
      body {margin:0 auto;width:60%;max-width:750px;font-family:'Helvetica Neue', Helvetica, Arial, sans-serif;}
      div, p {width:100%;}
      h1,h2,h3 {width:100%;text-align:center;}
      div.in                  {height:300px;border:1px solid #888;overflow-y:auto;margin-top:20px;background:white;font-family:monospace;white-space:pre;}
      div.in[data-type="url"] {height:2em;line-height:2em;}
      div.out {overflow-x:auto;}
      fieldset {border:0 none transparent;padding-left:0;display:inline-block;}
      
      /* Highlight */
      .javascript,.bibtex,.url {white-space:pre;font-family:monospace;}
      pre {background-color:#f0f0f0;overflow-x:auto;}
	/* JavaScript/JSON */
	  .javascript span.default {font-weight:normal;color:#000000;}
	  .javascript span.important {text-decoration:underline}
	  .javascript span.key {font-weight:normal;color:#0057ae;}
	  .javascript span.function {font-weight:normal;color:#644a9b;}
	  .javascript span.native {font-weight:bold;color:#000;}
	  .javascript span.object {font-weight:normal;color:#006e28;}
	  .javascript span.comment,
	  .javascript span.comment span {font-weight:normal;color:#888;}
	  .javascript span.string ,
	  .javascript span.string span {font-weight:normal;color:#bf0303;}
	  .javascript span.digit {font-weight:normal;color:#b08000;}
	  .javascript span.normal {font-weight:normal;color:#000;}
	  .javascript span.delimiter:after,
	  .javascript span.delimiter:before {content:' '}
	/* BibTeX */
	  .bibtex span.default {font-weight:normal;color:#000000;}
	  .bibtex span.entrytype {font-weight:bold;color:#000000;}
	  .bibtex span.label {font-weight:bold;color:#006e28;}
	  .bibtex span.property {font-weight:normal;color:#0057ae;}
	  .bibtex span.string {font-weight:normal;color:#bf0303;}
	  .bibtex span.digit {font-weight:normal;color:#b08000;}
	/* URL */
	  .url span.protocol {color:#888;}
	  .url span.domain {color:#000}
	  .url span.path {color:#888;}
	  .url span.parameters {color:#888;}
    </style>
  </head>
  <body>
    <h1>Citation.js - demo</h1>
    <h2>Input:</h2>
    <p><b style="font-size:12px;">Note that the inputs are interchangable. You could, for example, paste a URL in the JSON box. The syntax won't be coloured, but the output will be correct.</b></p>
    <h4>JSON:</h4>
    <div id="json-in" data-type="json" class="in javascript" contenteditable="true" spellcheck="false"><!--
-->[
  {
    id: "Q23571040",
    type: "article-journal",
    title: "Correlation of the Base Strengths of Amines 1",
    DOI: "10.1021/ja01577a030",
    author: [
      {
	given: "H. K.",
	family: "Hall"
      }
    ],
    issued: [
      {
	date-parts: [ "1957", "1", "1" ]
      }
    ],
    container-title: "Journal of the American Chemical Society",
    volume: "79",
    issue: "20",
    page: "5441-5444"
  }
]<!--
      --></div>
    <h4>BibTeX:</h4>
    <div id="bib-in" data-type="bib" class="in bibtex" contenteditable="true" spellcheck="false"><!--
-->@article{Steinbeck2003,
  author = {Steinbeck, Christoph and Han, Yongquan and Kuhn, Stefan and Horlacher, Oliver and Luttmann, Edgar and Willighagen, Egon},
  year = {2003},
  title = {{The Chemistry Development Kit (CDK): an open-source Java library for Chemo- and Bioinformatics.}},
  journal = {Journal of chemical information and computer sciences},
  volume = {43},
  number = {2},
  pages = {493--500},
  doi = {10.1021/ci025584y},
  isbn = {2214707786},
  issn = {0095-2338},
  pmid = {12653513},
  url = {http://www.ncbi.nlm.nih.gov/pubmed/12653513}
}<!--
      --></div>
    </div>
    <h4>Wikidata/URL:</h4>
    <p><b style="font-size:12px;">Note that Citation.js parses input via chaining. The data the URL points at is captured an re-parsed, so if the URL points to a text file containing an URL pointing to the first URL, you get an infinite loop. However, URL's pointing to itself are accounted for.</b></p>
    <div id="url-in" data-type="url" class="in url" contenteditable="true" spellcheck="false"><!--
      -->https://www.wikidata.org/wiki/Q21972834<!--
    --></div>
    <h4>ContentMine/JSON:</h4>
    <p><b style="font-size:12px;">This is the JSON scheme <a href="http://contentmine.org/">ContentMine</a>'s <a href="https://github.com/ContentMine/quickscrape">quickscrape</a> uses. Some properties are omitted to improve readability.</b></p>
    <div id="cm-in" data-type="json" class="in javascript" contenteditable="true" spellcheck="false"><!--
-->{
  "publisher": {
    "value": [
      "BioMed Central"
    ]
  },
  "journal": {
    "value": [
      "Journal of Ethnobiology and Ethnomedicine"
    ]
  },
  "title": {
    "value": [
      "Gitksan medicinal plants-cultural choice and efficacy"
    ]
  },
  "authors": {
    "value": [
      "Leslie Main Johnson"
    ]
  },
  "date": {
    "value": [
      "2006-06-21"
    ]
  },
  "doi": {
    "value": [
      "10.1186/1746-4269-2-29"
    ]
  },
  "volume": {
    "value": [
      "2"
    ]
  },
  "issue": {
    "value": [
      "1"
    ]
  },
  "firstpage": {
    "value": [
      "1"
    ]
  },
  "fulltext_html": {
    "value": [
      "http://ethnobiomed.biomedcentral.com/articles/10.1186/1746-4269-2-29"
    ]
  },
  "fulltext_pdf": {
    "value": [
      "http://ethnobiomed.biomedcentral.com/track/pdf/10.1186/1746-4269-2-29?site=http://ethnobiomed.biomedcentral.com"
    ]
  },
  "license": {
    "value": [
      "This article is published under license to BioMed Central Ltd. This is an Open Access article distributed under the terms of the Creative Commons Attribution License (http://creativecommons.org/licenses/by/2.0), which permits unrestricted use, distribution, and reproduction in any medium, provided the original work is properly cited."
    ]
  },
  "copyright": {
    "value": [
      "2006 Johnson; licensee BioMed Central Ltd."
    ]
  }
}<!--
     --></div>
    <h2>Output:</h2>
    <fieldset>
      <legend>HTML or plain text:</legend>
      <select class="type">
	<option value="html">HTML</option>
	<option value="string">Plain text</option>
      </select>
    </fieldset>
    <fieldset>
      <legend>Style:</legend>
      <select class="style">
	<option value="citation-apa">APA</option>
	<option value="citation-vancouver">Vancouver</option>
	<option value="citation-harvard1">Harvard</option>
	<option value="csl">JSON</option>
	<option value="bibtex">BibTeX</option>
      </select>
    </fieldset>
    <fieldset>
      <legend>Language:</legend>
      <select class="lang">
	<option value="en-US">English</option>
	<option value="fr-FR">French</option>
	<option value="es-ES">Spanish</option>
	<option value="de-DE">German</option>
	<option value="nl-NL">Dutch</option>
      </select>
    </fieldset>
    <h4>From JSON input:</h4>
    <div id="json-out" data-type="json" class="out"></div>
    <h4>From BibTeX input:</h4>
    <div id="bib-out" data-type="bib" class="out"></div>
    <h4>From Wikidata/URL input:</h4>
    <!--p><b style="font-size:12px;">Note that Citation.js can't parse every Wikidata property. This would require many calls to the database, since properties often have numeric-id's instead of values.</b></p-->
    <div id="url-out" data-type="url" class="out"></div>
    <h4>From ContentMine input:</h4>
    <div id="cm-out" data-type="cm" class="out"></div>
    <h2>Live code:</h2>
    <pre><code data-type="js" class="javascript"></code></pre>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script type="text/javascript" src="../src/citation.min.js"></script>
    <script type="text/javascript">
      /* Code highlighting. Feel free to use, but note it isn't that solid */
      jQuery.fn.highlight = function() {
	$(this).each(function(){
	  var elm = $(this);
	  switch(elm.data('type')){
	    case 'json':case 'js':
	      elm.html(elm.text()
		.replace(/([^\"]*)([\"][^\"]*[\"])([^\"]*)/gi,'$1<span class="string">$2</span>$3')
		.replace(/([^\']*)([\'][^\']*[\'])([^\']*)/gi,'$1<span class="string">$2</span>$3')
		.replace(/(function|this|document|for|if|else|var|true|false|throw|return|while|break|typeof|catch|new|undefined|null|class|yield|let|const|switch|break|case|continue|try|delete|in|of)([\s()]+)/g,
		  '<span class="native">$1</span>$2')
		.replace(/(\w+)(?=\.)/gi, '<span class="object">$1</span>')
		.replace(/(cite)([(<])/gi, '<span class="important">$1</span>$2')
		.replace(/(cite)([^\(<])/gi, '<span class="important">$1</span>$2')
		.replace(/(\w+)(\s*\:)/gi,'<span class="key">$1</span>$2')
		.replace(/([\s\.{};(])([\w$]+)(?=\s*\()/gi,'$1<span class="function">$2</span>')
		.replace(/^(.*)(\/\/.*)$/gim,'$1<span class="comment">$2</span>')
		.replace(/(\/\*[\s\S]*?\*\/)/gi,'<span class="comment">$1</span>')
		.replace(/(-?(?:\d+\.\d+|\d+\.|\.\d+|\d+)(?:e\d+)?)/gi,'<span class="digit">$1</span>')
	      );
	      break;
	    case 'bib':
	      elm.html(elm.text()
		.replace(/(=\s*)(?:("{)(.*?)(}")|(")(.*?)(")|({{)(.*?)(}})|({)(.*?)(})|(.*?))(?=\s*[,}])/g,
			function (m,p1,p2,p3,p4,p5,p6,p7,p8,p9,p10,p11,p12,p13,p14) {
			  p1=p1||'',p2=p2||'',p3=p3||'',p4=p4||'',p5=p5||'',p6=p6||'',p7=p7||'',p8=p8||'',
			  p9=p9||'',p10=p10||'',p11=p11||'',p12=p12||'',p13=p13||'',p14=p14||'';
			  var rgx = /^\d+$/, string = (
			    p3 .match( rgx ) ||
			    p6 .match( rgx ) ||
			    p9 .match( rgx ) ||
			    p12.match( rgx ) ||
			    p14.match( rgx )
			  ) ?
			    'digit'
			  :
			    'string';
			  
			  return `${p1+p2+p5+p8+p11}<span class="${string}">${p3+p6+p9+p12+p14}</span>${p4+p7+p10+p13}`//
			})
		.replace(/(\@)([^\@\{]+)(\{)(\w+)(\,)/gi,'$1<span class="entrytype">$2</span>$3<span class="label">$4</span><span class="default">$5</span>')
		.replace(/(\w+)\s*(\=)(\s|[^\'\"\w]+)/gi,'<span class="property">$1</span> $2 ')
	      );
	      break;
	    case 'url':
	      elm.html(elm.text()
		.replace(/(https?:\/\/)?((([a-z\d]([a-z\d-]*[a-z\d])*)\.)+[a-z]{2,}|((\d{1,3}\.){3}\d{1,3}))(\:\d+)?((\/[-a-z\d%_.~+:]*)*)(\?[;&a-z\d%_.~+=-]*)?(\#[-a-z\d_]*)?/gi,
		  '<span class="protocol">$1</span>'+
		  '<span class="domain">$2$8</span>'+
		  '<span class="path">$9$12</span>'+
		  '<span class="parameters">$11</span>'
		)
	      )
	      break;
	    default:return;break;
	  }
	});
      }
    </script>
    <script class="code" type="text/javascript">
var Cite = require('citation-js')

// Set variable to store data
var jsondata = new Cite()
  ,  bibdata = new Cite()
  ,  urldata = new Cite()
  ,   cmdata = new Cite()
  
$(function(){
  
  // Declare function to update the output
  function update() {
    
    // Set data
    jsondata.set( $( '#json-in' ).text() )
     bibdata.set( $(  '#bib-in' ).text() )
     urldata.set( $(  '#url-in' ).text() )
      cmdata.set( $(   '#cm-in' ).text() )
    
    // Get options
    var opt = {
      format: 'string',
      type  : $( 'select.type'  ).val(),
      style : $( 'select.style' ).val(),
      lang  : $( 'select.lang'  ).val()
    }
    
    // Set options
    jsondata.options( opt )
     bibdata.options( opt )
     urldata.options( opt )
      cmdata.options( opt )
    
    // Get data
    $( '#json-out' ).html( jsondata.get() )
    $(  '#bib-out' ).html(  bibdata.get() )
    $(  '#url-out' ).html(  urldata.get() )
    $(   '#cm-out' ).html(   cmdata.get() )
    
  }
  
  // Declare function to execute code async, to prevent page lagging
  function asyncUpdate () {
    setTimeout( update, 0 )
  }
  
  // Make output update when input is defocussed...
  $( '.in' ).on( 'blur', asyncUpdate )
  // ... or a select tag has changed
  $( 'select' ).on( 'change', asyncUpdate )
  
  // Trigger update
  asyncUpdate()
  
});
    </script>
    <script type="text/javascript">
      $(window).on('load',function(){
	// Insert live code, directly from the script element (!)
	$('pre code.javascript').html($('.code').html());	
	
	// Highlight all code
	$('.javascript,.in').highlight();
	
	// Remove and re-add highlighting on focus and blur
	$('.in').focus(function(){$(this).find('span').each(function(){$(this).after(this.textContent);$(this).remove();});});
	$('.in').blur(function(){$(this).highlight()});
      });
    </script>
  </body>
</html>