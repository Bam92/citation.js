<!DOCTYPE html>
<html>
  <head>
    <title>Demo | Citation.js</title>
    <style>
      body {margin:0 auto;width:60%;max-width:750px;font-family:'Helvetica Neue', Helvetica, Arial, sans-serif;}
      div, p {width:100%;}
      h1,h2,h3 {width:100%;text-align:center;}
      div.in p {margin-top:0;margin-bottom:0;}
      div.in			{height:300px;border:1px solid #888;overflow-y:auto;margin-top:20px;background:white;font-family:monospace;}
      div.in[data-type="url"]	{height:2em;line-height:2em;}
      p.indent1{text-indent:20px;}p.indent2{text-indent:40px;}
      div.nomargin{margin:0;}.out p{margin:3px 0;}
      div.out {overflow-x:auto;}
      fieldset {border:0 none transparent;padding-left:0;display:inline-block;}
      
      /* Highlight */
      pre {background-color:#f0f0f0;overflow-x:scroll;}
	/* JavaScript/JSON */
	  .javascript span.default {font-weight:normal;color:#000000;}
	  .javascript span.important {text-decoration:underline}
	  .javascript span.key {font-weight:normal;color:#0057ae;}
	  .javascript span.function {font-weight:normal;color:#644a9b;}
	  .javascript span.native {font-weight:bold;color:#000;}
	  .javascript span.object {font-weight:normal;color:#006e28;}
	  .javascript span.comment,
	  .javascript span.comment span {font-weight:normal;color:#888;}
	  .javascript span.string ,
	  .javascript span.string span {font-weight:normal;color:#bf0303;}
	  .javascript span.digit {font-weight:normal;color:#b08000;}
	  .javascript span.normal {font-weight:normal;color:#000;}
	/* BibTeX */
	  .bibtex span.default {font-weight:normal;color:#000000;}
	  .bibtex span.entrytype {font-weight:bold;color:#000000;}
	  .bibtex span.label {font-weight:bold;color:#006e28;}
	  .bibtex span.property {font-weight:normal;color:#0057ae;}
	  .bibtex span.string {font-weight:normal;color:#bf0303;}
	  .bibtex span.digit {font-weight:normal;color:#b08000;}
	/* URL */
	  .url span.protocol {color:#888;}
	  .url span.domain {color:#000}
	  .url span.path {color:#888;}
	  .url span.parameters {color:#888;}
    </style>
  </head>
  <body>
    <h1>Citation.js - Wikidata demo</h1>
    <h2>Input:</h2>
    <h4>Wikidata/URL:</h4>
    <div id="url-in" data-type="url" class="in url" contenteditable="true" spellcheck="false">
      https://www.wikidata.org/wiki/Q23571040
    </div>
    <h2>Output:</h2>
    <fieldset>
      <legend>Style:</legend>
      <select class="format">
	<option value="Vancouver">Vancouver</option>
	<option value="APA">APA</option>
	<option value="JSON">JSON</option>
	<option value="BibTeX">BibTeX</option>
      </select>
    </fieldset>
    <fieldset>
      <legend>Language:</legend>
      <select class="lan">
	<option value="en">English</option>
	<option value="nl">Dutch</option>
      </select>
    </fieldset>
    <fieldset>
      <legend>HTML or plain text:</legend>
      <select class="html">
	<option value="html">HTML</option>
	<option value="string">Plain text</option>
      </select>
    </fieldset>
    <h4>From Wikidata/URL input:</h4>
    <p><b style="font-size:12px;">Note that Citation.js can't parse every Wikidata property. This would require many calls to the database, since properties often have numeric-id's instead of values.</b></p>
    <div id="url-out" data-type="url" class="out"></div>
    <h2>Live code:</h2>
    <pre><code data-type="js" class="javascript"></code></pre>
    <script type="text/javascript" src="src/jquery-2.1.4.min.js"></script>
    <script type="text/javascript" src="src/Citation-0.1.js"></script>
    <script type="text/javascript">
      /* Code highlighting. Feel free to use, but note it isn't that solid */
      jQuery.fn.highlight = function() {
	$(this).each(function(){
	  var elm = $(this);
	  switch(elm.data('type')){
	    case 'json':case 'js':
	      elm.html(elm.html()
		.replace(/([^\']*)([\'][^\']*[\'])([^\']*)/gi,'$1<span class="string">$2</span>$3')
		.replace(/(\w+)(?=\.)/gi, '<span class="object">$1</span>')
		.replace(/(cite)([(<])/gi, '<span class="important">$1</span>$2')
		.replace(/(cite)([^\(<])/gi, '<span class="important">$1</span>$2')
		.replace(/(\w+)(\:)/gi,'<span class="key">$1</span>$2')
		.replace(/([\s\.{};])([\w$]+)\s*([(])/gi,'$1<span class="function">$2</span>$3')
		.replace(/(function|this|document|for|if|else|var|true|false|throw|return|while|break|typeof|catch|new|undefined|null|class|yield|let|const|switch|break|case|continue|try)([\s()]+)/g,
		  '<span class="native">$1</span>$2')
		.replace(/^(.*)(\/\/.*)$/gim,'$1<span class="comment">$2</span>')
		.replace(/(\/\*[\s\S]*\*\/)/gi,'<span class="comment">$1</span>')
		.replace(/([^\'\"\w])(\d+)/gi,'$1<span class="digit">$2</span>')
	      );
	      break;
	    case 'bib':
	      elm.html(elm.html()
		.replace(/(\@)([^\@\{]+)(\{)(\w+)(\,)/gi,'$1<span class="entrytype">$2</span>$3<span class="label">$4</span><span class="default">$5</span>')
		.replace(/(\{{1,2})([^\{\}]*)(\}{0,3})/gi,'$1<span class="string">$2</span>$3')
		.replace(/(\w+)\s*(\=)(\s|[^\'\"\w]+)/gi,'<span class="property">$1</span> $2 ')
		.replace(/([^\'\"\w])([\d\.\-]+)/gi,'$1<span class="digit">$2</span>')
	      );
	      break;
	    case 'url':
	      elm.html(elm.html()
		.replace(/(https?:\/\/)?((([a-z\d]([a-z\d-]*[a-z\d])*)\.)+[a-z]{2,}|((\d{1,3}\.){3}\d{1,3}))(\:\d+)?((\/[-a-z\d%_.~+:]*)*)(\?[;&a-z\d%_.~+=-]*)?(\#[-a-z\d_]*)?/gi,
		  '<span class="protocol">$1</span>'+
		  '<span class="domain">$2$8</span>'+
		  '<span class="path">$9$12</span>'+
		  '<span class="parameters">$11</span>'
		)
	      )
	      break;
	    default:return;break;
	  }
	});
      }
    </script>
    <script class="code" type="text/javascript">
// Set variable to store data
var urldata = new Cite();
  
$(function(){

  // Declare function to update the output
  function update() {
    
    // (Re)setting data
    urldata.set($('.in[data-type="url"]' ).text());
     
    // (Re)setting options
    var opt = {
      type: 'string',
      style: $('select.format').val(),
      lan: $('select.lan').val(),
      format: $('select.html').val()
    };
    urldata.options(opt);
    
    // Getting data
    $('.out[data-type="url"]').html(urldata.get());
      
  }
  
  // Make output update when input is defocussed...
  $('.in').on('blur',update);
  // .. or a select tag has changed
  $('select').on('change',update);
  
  // Trigger update
  update();
  
});
    </script>
    <script type="text/javascript">
      $(window).on('load',function(){
	// Insert live code, directly from the script element (!)
	$('pre code.javascript').html($('.code').html());
	// Highlight all code
	$('.javascript,.url').highlight();
	// Remove and re-add highlighting on focus and blur
	$('.in').focus(function(){$(this).find('span').each(function(){$(this).after(this.textContent);$(this).remove();});});
	$('.in').blur(function(){$(this).highlight()});
      });
    </script>
  </body>
</html>